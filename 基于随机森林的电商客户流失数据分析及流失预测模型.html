
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>分析思路 &#8212; 基于随机森林的电商客户流失数据分析及流失预测模型</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '基于随机森林的电商客户流失数据分析及流失预测模型';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder=""
         aria-label=""
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">基于随机森林的电商客户流失数据分析及流失预测模型</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/基于随机森林的电商客户流失数据分析及流失预测模型.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>分析思路</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">分析思路</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">一、数据处理</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.1 处理缺失值</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">查看以下字段数据分布来确定缺失值填充方法</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">二、用户特征深度解析</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1 静态属性特征</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a1">a1 高频登录终端类型-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a2">a2 高频登录终端类型-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b1">b1 城市等级-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b2">b2 城市等级-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c1">c1 性别分布-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c2">c2 性别分布-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d1">d1 用户年龄-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d2">d2 用户年龄-数据可视化</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">2.2 动态属性特征</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">a1 服务满意度评级-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">a2 服务满意度评级-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b1-app">b1 APP使用时长-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">c1 上月客诉-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">c2 上月客诉-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">d1 关注的主播总数-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">d2 关注的主播总数-可视化</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">三、特征与流失相关性</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">3.1 相关性分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-cramer-s-v">对数据进行编码后采用默认的pearson，这种方法具有一定的局限性，所以后续结合随机森林来确定哪些特征进入模型。<br/>效果不好的情况可以采用点二列相关系数、Cramer”s V系数或者综合用互信息等相关方法</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">3.1.1 读取处理之后的数据</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">3.1.2 对分类变量进行独热编码</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">3.1.3 计算相关性</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">3.1.4 使用随机森林来筛选重要特征</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">查看数据样本是否均衡</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">数据存在轻微不平衡 可以先不处理，后续模型表现不佳的情况可以重新处理</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">打乱数据</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">四、客户画像–基于筛选出的重要特征构建已流失客户的客户画像</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">4.1.1 已流失客户的客户画像概述</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">五、建立客户流失预测模型</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gbdtadaboostlightgbm-svm">5.1.1 对比各种逻辑回归、决策树、随机森林、GBDT、adaboost、LightGBM、朴素贝叶斯，svm算法的表现</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">5.1.2 模型报告——最优模型 最佳参数</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">六、可视化大屏</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tableau">该部分用tableau实现</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">七、报告</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>分析思路<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<p>分析指标体系
<br> – 用户基本属性:
<br>   – 年龄段
<br>   – 性别
<br>   – 城市等级
<br>   – 婚姻状态
<br> – 用户行为指标
<br>   – 用户生命周期
<br>   – 偏好登录设备
<br>   – APP使用时长
<br>   – 关注主播数量
<br>   – 满意度、客诉等
<br> – 订单指标
<br>   – 偏好订单类型
<br>   – 去年订单增长率
<br>   – 上月优惠券使用数量
<br>   – 上月订单数量
<br>   – 距上次下单时间间隔
<br>   – 上月返现金额
<br>或者以客户为中心分为
<br> 用户静态属性（年龄、性别等）
<br> 用户动态属性（服务满意度、APP使用时长等）
<br> 本次分析采用后者</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">VotingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">roc_curve</span>

<span class="kn">from</span> <span class="nn">pyecharts.globals</span> <span class="kn">import</span> <span class="n">CurrentConfig</span><span class="p">,</span> <span class="n">NotebookType</span>
<span class="n">CurrentConfig</span><span class="o">.</span><span class="n">NOTEBOOK_TYPE</span> <span class="o">=</span> <span class="n">NotebookType</span><span class="o">.</span><span class="n">JUPYTER_LAB</span>
<span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Line</span><span class="p">,</span> <span class="n">Pie</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">Map</span><span class="p">,</span> <span class="n">Scatter</span><span class="p">,</span> <span class="n">Boxplot</span><span class="p">,</span> <span class="n">Pie</span>
<span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">pyecharts.commons.utils</span> <span class="kn">import</span> <span class="n">JsCode</span>
<span class="kn">from</span> <span class="nn">pyecharts.globals</span> <span class="kn">import</span> <span class="n">ThemeType</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
  
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>

<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id2">
<h1>一、数据处理<a class="headerlink" href="#id2" title="Link to this heading">#</a></h1>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;./data/eucdata.xlsx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 5630 entries, 0 to 5629
Data columns (total 19 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   CustomerID                   5630 non-null   int64  
 1   Churn                        5630 non-null   int64  
 2   Tenure                       5366 non-null   float64
 3   PreferredLoginDevice         5630 non-null   object 
 4   CityTier                     5630 non-null   int64  
 5   WarehouseToHome              5379 non-null   float64
 6   MaritalStatus                5630 non-null   object 
 7   AgeGroup                     5630 non-null   int64  
 8   Gender                       5630 non-null   object 
 9   HourSpendOnApp               5375 non-null   float64
 10  OrderCount                   5372 non-null   float64
 11  OrderAmountHikeFromlastYear  5365 non-null   float64
 12  DaySinceLastOrder            5323 non-null   float64
 13  PreferedOrderCat             5630 non-null   object 
 14  NumberOfStreamerFollowed     5630 non-null   int64  
 15  SatisfactionScore            5630 non-null   int64  
 16  Complain                     5630 non-null   int64  
 17  CouponUsed                   5374 non-null   float64
 18  DiscountAmount               5630 non-null   float64
dtypes: float64(8), int64(7), object(4)
memory usage: 835.8+ KB
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h2>1.1 处理缺失值<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CustomerID                     0.000000
Churn                          0.000000
Tenure                         4.689165
PreferredLoginDevice           0.000000
CityTier                       0.000000
WarehouseToHome                4.458259
MaritalStatus                  0.000000
AgeGroup                       0.000000
Gender                         0.000000
HourSpendOnApp                 4.529307
OrderCount                     4.582593
OrderAmountHikeFromlastYear    4.706927
DaySinceLastOrder              5.452931
PreferedOrderCat               0.000000
NumberOfStreamerFollowed       0.000000
SatisfactionScore              0.000000
Complain                       0.000000
CouponUsed                     4.547069
DiscountAmount                 0.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3>查看以下字段数据分布来确定缺失值填充方法<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>Tenure
<br>WarehouseToHome
<br>HourSpendOnApp
<br>OrderCount
<br>OrderAmountHikeFromlastYear
<br>DaySinceLastOrder
<br>CouponUsed</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_tmp</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">,</span> <span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">,</span> <span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderCount&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;DiscountAmount&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">boxplot_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">,</span> <span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">,</span> <span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderCount&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;DiscountAmount&quot;</span><span class="p">]:</span>
    <span class="n">boxplot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


<span class="n">boxplot</span> <span class="o">=</span> <span class="n">Boxplot</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">boxplot</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">([</span><span class="s2">&quot;Tenure&quot;</span><span class="p">,</span> <span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">,</span> <span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderCount&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;DiscountAmount&quot;</span><span class="p">])</span>
<span class="n">boxplot</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">boxplot</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">(</span><span class="n">boxplot_data</span><span class="p">))</span>


<span class="n">boxplot</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;各字段数据分布箱线图&quot;</span><span class="p">),</span>
    <span class="n">xaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;字段名&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;数值&quot;</span><span class="p">),</span>
    
<span class="p">)</span>
<span class="n">html_boxplot</span> <span class="o">=</span> <span class="n">boxplot</span><span class="o">.</span><span class="n">render_embed</span><span class="p">()</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">html_boxplot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.boxplot.Boxplot at 0x2a765ec9970&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.boxplot.Boxplot at 0x2a765ec9970&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.boxplot.Boxplot at 0x2a765ec9970&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="1233093ba98541958abfe2253d9e68bb" style="width:1000px; height:600px;"></div>
    <script>
        var chart_1233093ba98541958abfe2253d9e68bb = echarts.init(
            document.getElementById('1233093ba98541958abfe2253d9e68bb'), 'light', {renderer: 'canvas'});
        var option_1233093ba98541958abfe2253d9e68bb = {
    "series": [
        {
            "type": "boxplot",
            "data": [
                [
                    1.0,
                    3.0,
                    8.0,
                    15.0,
                    63.0
                ],
                [
                    5.0,
                    9.0,
                    14.0,
                    20.0,
                    127.0
                ],
                [
                    0.0,
                    2.0,
                    3.0,
                    3.0,
                    5.0
                ],
                [
                    1.0,
                    1.0,
                    2.0,
                    3.0,
                    16.0
                ],
                [
                    11.0,
                    13.0,
                    15.0,
                    18.0,
                    26.0
                ],
                [
                    0.0,
                    2.0,
                    3.0,
                    7.0,
                    46.0
                ],
                [
                    0.0,
                    148.98,
                    162.60500000000002,
                    182.385,
                    324.99
                ]
            ],
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "markPoint": {
                "label": {
                    "show": true,
                    "position": "inside",
                    "color": "#fff",
                    "margin": 8
                }
            },
            "markLine": {
                "silent": false,
                "precision": 2,
                "label": {
                    "show": true,
                    "position": "top",
                    "margin": 8
                }
            }
        }
    ],
    "legend": [
        {
            "data": [
                ""
            ],
            "selected": {
                "": true
            },
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "name": "\u5b57\u6bb5\u540d",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Tenure",
                "WarehouseToHome",
                "HourSpendOnApp",
                "OrderCount",
                "OrderAmountHikeFromlastYear",
                "DaySinceLastOrder",
                "DiscountAmount"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u503c",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u5404\u5b57\u6bb5\u6570\u636e\u5206\u5e03\u7bb1\u7ebf\u56fe"
        }
    ]
};
        chart_1233093ba98541958abfe2253d9e68bb.setOption(option_1233093ba98541958abfe2253d9e68bb);
    </script>
</body>
</html>
</div></div>
</div>
<p><strong>Tenure</strong>
<br>分布形状：从箱线图来看，数据大致呈右偏分布。箱体的上边缘（第三四分位数）和下边缘（第一四分位数）之间的距离相对较近，表明大部分客户使用平台的时长集中在某个较窄的范围内。<br>中位数线位于箱体的中下部，说明较多客户的使用时长在中间偏下的位置。
<br>异常值：没有明显的异常值。<strong>中位数填充</strong></p>
<p><strong>WarehouseToHome</strong>
<br>分布形状：大致呈右偏分布。箱体的范围较窄，中位数线位于箱体中间偏下的位置，表明大部分客户的仓库到家距离较近，但也有部分客户距离较远，使得上须（箱体顶部的线）延伸到较高的值。
<br>异常值：没有明显的异常值。<strong>中位数填充</strong></p>
<p><strong>HourSpendOnApp</strong>
<br>分布形状：大致呈右偏分布。箱体较窄，中位数线位于箱体中间偏下的位置，表明多数客户在应用上的花费时间较短，但有部分客户花费时间较长，使得上须延伸到较高的值。
<br>异常值：没有明显的异常值。<strong>众数填充</strong></p>
<p><strong>OrderCount</strong>
<br>分布形状：大致呈右偏分布。箱体范围较窄，中位数线位于箱体中间偏下的位置，说明大部分客户的订单数较少，但存在一些订单数较多的客户，导致上须延伸到较高的值。
<br>异常值：没有明显的异常值。<strong>0填充</strong></p>
<p><strong>OrderAmountHikeFromlastYear</strong>
<br>分布形状：大致呈右偏分布。箱体范围较窄，中位数线位于箱体中间偏下的位置，表明多数客户的订单金额增长幅度较小，但有部分客户的订单金额增长幅度较大，使得上须延伸到较高的值。
<br>异常值：没有明显的异常值。<strong>中位数填充</strong></p>
<p><strong>DaySinceLastOrder</strong>
<br>分布形状：大致呈右偏分布。箱体范围较窄，中位数线位于箱体中间偏下的位置，说明大部分客户最近下单时间较近，但有部分客户较长时间未下单，导致上须延伸到较高的值。
<br>异常值：没有明显的异常值。<strong>中位数填充</strong></p>
<p><strong>DiscountAmount</strong>
<br>分布形状：大致呈右偏分布。箱体范围较宽，中位数线位于箱体中间偏下的位置，表明折扣金额的分布较为分散，且大部分客户的折扣金额较小，但存在一些折扣金额非常高的客户，使得上须延伸到很高的值。
<br>异常值：存在一些异常值，表明有少数客户获得了非常高的折扣金额。<strong>中位数填充</strong></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;OrderCount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;CouponUsed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;CouponUsed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&quot;./data/clean.xlsx&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id5">
<h1>二、用户特征深度解析<a class="headerlink" href="#id5" title="Link to this heading">#</a></h1>
<section id="id6">
<h2>2.1 静态属性特征<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<section id="a1">
<h3>a1 高频登录终端类型-数据处理<a class="headerlink" href="#a1" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dvc_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># dvc_df[&quot;Churn&quot;] = dvc_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># dvc_df[&quot;type&quot;] = dvc_df[&quot;PreferredLoginDevice&quot;] + &quot;_&quot; + dvc_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">dvc_df_lost</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># dvc_df_lost[&quot;ratio&quot;] = dvc_df_lost[&quot;cnt&quot;] / sum(dvc_df_lost[&quot;cnt&quot;])</span>


<span class="n">dvc_list</span> <span class="o">=</span>  <span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">dvc_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dvc_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dvc_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dvc_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dvc_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dvc_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dvc_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dvc_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">dvc_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">dvc_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dvc_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">dvc_df</span><span class="p">[(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dvc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dvc_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">dvc_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">dvc_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;PreferredLoginDevice&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dvc_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">dvc_df</span>
<span class="n">dvc_df_lost</span>
<span class="n">dvc_list</span>
<span class="n">dvc_churn0_cnt</span><span class="p">;</span><span class="n">dvc_churn0_bg</span><span class="p">;</span><span class="n">dvc_churn0_wg</span>
<span class="n">dvc_churn1_cnt</span><span class="p">;</span><span class="n">dvc_churn1_bg</span><span class="p">;</span><span class="n">dvc_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PreferredLoginDevice</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Mobile Phone</td>
      <td>0</td>
      <td>2417</td>
      <td>0.429307</td>
      <td>0.874141</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mobile Phone</td>
      <td>1</td>
      <td>348</td>
      <td>0.061812</td>
      <td>0.125859</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Pad</td>
      <td>0</td>
      <td>1310</td>
      <td>0.232682</td>
      <td>0.801714</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pad</td>
      <td>1</td>
      <td>324</td>
      <td>0.057549</td>
      <td>0.198286</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Phone</td>
      <td>0</td>
      <td>955</td>
      <td>0.169627</td>
      <td>0.775792</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Phone</td>
      <td>1</td>
      <td>276</td>
      <td>0.049023</td>
      <td>0.224208</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PreferredLoginDevice</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Mobile Phone</td>
      <td>348</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pad</td>
      <td>324</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Phone</td>
      <td>276</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Mobile Phone&#39;, &#39;Pad&#39;, &#39;Phone&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2417, 1310, 955]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[42.93, 23.27, 16.96]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[87.41, 80.17, 77.58]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[348, 324, 276]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6.18, 5.75, 4.9]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[12.59, 19.83, 22.42]
</pre></div>
</div>
</div>
</div>
</section>
<section id="a2">
<h3>a2 高频登录终端类型-可视化<a class="headerlink" href="#a2" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dvc_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">dvc_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">dvc_list</span><span class="p">)</span>
<span class="n">dvc_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dvc_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">dvc_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dvc_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">dvc_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">dvc_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;设备类型客户分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">dvc_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">dvc_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">dvc_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">dvc_list</span><span class="p">)</span>
<span class="n">dvc_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">dvc_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">dvc_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">dvc_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">dvc_bar_line</span> <span class="o">=</span> <span class="n">dvc_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">dvc_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">dvc_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765e48c20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766091dc0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766091dc0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766091dc0&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="81b202b242da4fdb935c64599124d432" style="width:1000px; height:600px;"></div>
    <script>
        var chart_81b202b242da4fdb935c64599124d432 = echarts.init(
            document.getElementById('81b202b242da4fdb935c64599124d432'), 'light', {renderer: 'canvas'});
        var option_81b202b242da4fdb935c64599124d432 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                2417.0,
                1310.0,
                955.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                348.0,
                324.0,
                276.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Mobile Phone",
                    42.93
                ],
                [
                    "Pad",
                    23.27
                ],
                [
                    "Phone",
                    16.96
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Mobile Phone",
                    6.18
                ],
                [
                    "Pad",
                    5.75
                ],
                [
                    "Phone",
                    4.9
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Mobile Phone",
                "Pad",
                "Phone"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 50,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u8bbe\u5907\u7c7b\u578b\u5ba2\u6237\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_81b202b242da4fdb935c64599124d432.setOption(option_81b202b242da4fdb935c64599124d432);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dvc_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">dvc_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">dvc_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">dvc_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">dvc_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="a47237285bbf45088cf18870d4a3961f" style="width:900px; height:500px;"></div>
    <script>
        var chart_a47237285bbf45088cf18870d4a3961f = echarts.init(
            document.getElementById('a47237285bbf45088cf18870d4a3961f'), 'light', {renderer: 'canvas'});
        var option_a47237285bbf45088cf18870d4a3961f = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                87.41,
                80.17,
                77.58
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                12.59,
                19.83,
                22.42
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Mobile Phone",
                "Pad",
                "Phone"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_a47237285bbf45088cf18870d4a3961f.setOption(option_a47237285bbf45088cf18870d4a3961f);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dvc_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">dvc_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="165cdcaa8fc64947855f5dbe736c5d9d" style="width:900px; height:500px;"></div>
    <script>
        var chart_165cdcaa8fc64947855f5dbe736c5d9d = echarts.init(
            document.getElementById('165cdcaa8fc64947855f5dbe736c5d9d'), 'light', {renderer: 'canvas'});
        var option_165cdcaa8fc64947855f5dbe736c5d9d = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "Mobile Phone",
                    "value": 348
                },
                {
                    "name": "Pad",
                    "value": 324
                },
                {
                    "name": "Phone",
                    "value": 276
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "Mobile Phone",
                "Pad",
                "Phone"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_165cdcaa8fc64947855f5dbe736c5d9d.setOption(option_165cdcaa8fc64947855f5dbe736c5d9d);
    </script>
</body>
</html>
</div></div>
</div>
</section>
<section id="b1">
<h3>b1 城市等级-数据处理<a class="headerlink" href="#b1" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># euc_df[&quot;CityTier&quot;] = euc_df[&quot;CityTier&quot;].astype(&quot;str&quot;)</span>
<span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;Tier1&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s2">&quot;Tier2&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s2">&quot;Tier3&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;CityTier&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># city_df[&quot;Churn&quot;] = city_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># city_df[&quot;type&quot;] = city_df[&quot;CityTier&quot;] + &quot;_&quot; + city_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">city_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;CityTier&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">city_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">city_df_lost</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># city_df_lost[&quot;ratio&quot;] = city_df_lost[&quot;cnt&quot;] / sum(city_df_lost[&quot;cnt&quot;])</span>


<span class="n">city_list</span> <span class="o">=</span>  <span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">city_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">city_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">city_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">city_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">city_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">city_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">city_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">city_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">city_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">city_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">city_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">city_df</span><span class="p">[(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">city_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">city_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">city_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">city_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;CityTier&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">city_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">city_df</span>
<span class="n">city_df_lost</span>
<span class="n">city_list</span>
<span class="n">city_churn0_cnt</span><span class="p">;</span><span class="n">city_churn0_bg</span><span class="p">;</span><span class="n">city_churn0_wg</span>
<span class="n">city_churn1_cnt</span><span class="p">;</span><span class="n">city_churn1_bg</span><span class="p">;</span><span class="n">city_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CityTier</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Tier1</td>
      <td>0</td>
      <td>3134</td>
      <td>0.556661</td>
      <td>0.854883</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Tier1</td>
      <td>1</td>
      <td>532</td>
      <td>0.094494</td>
      <td>0.145117</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Tier2</td>
      <td>0</td>
      <td>194</td>
      <td>0.034458</td>
      <td>0.801653</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tier2</td>
      <td>1</td>
      <td>48</td>
      <td>0.008526</td>
      <td>0.198347</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Tier3</td>
      <td>0</td>
      <td>1354</td>
      <td>0.240497</td>
      <td>0.786295</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Tier3</td>
      <td>1</td>
      <td>368</td>
      <td>0.065364</td>
      <td>0.213705</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CityTier</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Tier1</td>
      <td>532</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tier2</td>
      <td>48</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Tier3</td>
      <td>368</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Tier1&#39;, &#39;Tier2&#39;, &#39;Tier3&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3134, 194, 1354]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55.67, 3.45, 24.05]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[85.49, 80.17, 78.63]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[532, 48, 368]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9.45, 0.85, 6.54]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14.51, 19.83, 21.37]
</pre></div>
</div>
</div>
</div>
</section>
<section id="b2">
<h3>b2 城市等级-可视化<a class="headerlink" href="#b2" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">city_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">city_list</span><span class="p">)</span>
<span class="n">city_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">city_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">city_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">city_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">city_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">city_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;城市类型客户分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">city_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">city_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">city_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">city_list</span><span class="p">)</span>
<span class="n">city_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">city_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">city_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">city_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># 使用次坐标轴</span>
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">city_bar_line</span> <span class="o">=</span> <span class="n">city_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">city_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">city_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a765975940&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a7660aaa80&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a7660aaa80&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a7660aaa80&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="f135ed2344f3430b95603a27e8f26c23" style="width:1000px; height:600px;"></div>
    <script>
        var chart_f135ed2344f3430b95603a27e8f26c23 = echarts.init(
            document.getElementById('f135ed2344f3430b95603a27e8f26c23'), 'light', {renderer: 'canvas'});
        var option_f135ed2344f3430b95603a27e8f26c23 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                3134.0,
                194.0,
                1354.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                532.0,
                48.0,
                368.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Tier1",
                    55.67
                ],
                [
                    "Tier2",
                    3.45
                ],
                [
                    "Tier3",
                    24.05
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Tier1",
                    9.45
                ],
                [
                    "Tier2",
                    0.85
                ],
                [
                    "Tier3",
                    6.54
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Tier1",
                "Tier2",
                "Tier3"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u57ce\u5e02\u7c7b\u578b\u5ba2\u6237\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_f135ed2344f3430b95603a27e8f26c23.setOption(option_f135ed2344f3430b95603a27e8f26c23);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">city_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">city_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">city_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">city_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="be5830632d2c4ed2bdf8fe814739fac5" style="width:900px; height:500px;"></div>
    <script>
        var chart_be5830632d2c4ed2bdf8fe814739fac5 = echarts.init(
            document.getElementById('be5830632d2c4ed2bdf8fe814739fac5'), 'light', {renderer: 'canvas'});
        var option_be5830632d2c4ed2bdf8fe814739fac5 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                85.49,
                80.17,
                78.63
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                14.51,
                19.83,
                21.37
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Tier1",
                "Tier2",
                "Tier3"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_be5830632d2c4ed2bdf8fe814739fac5.setOption(option_be5830632d2c4ed2bdf8fe814739fac5);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">city_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="2370009b56e6497c8227dfd382411df0" style="width:900px; height:500px;"></div>
    <script>
        var chart_2370009b56e6497c8227dfd382411df0 = echarts.init(
            document.getElementById('2370009b56e6497c8227dfd382411df0'), 'light', {renderer: 'canvas'});
        var option_2370009b56e6497c8227dfd382411df0 = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "Tier1",
                    "value": 532
                },
                {
                    "name": "Tier2",
                    "value": 48
                },
                {
                    "name": "Tier3",
                    "value": 368
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "Tier1",
                "Tier2",
                "Tier3"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_2370009b56e6497c8227dfd382411df0.setOption(option_2370009b56e6497c8227dfd382411df0);
    </script>
</body>
</html>
</div></div>
</div>
</section>
<section id="c1">
<h3>c1 性别分布-数据处理<a class="headerlink" href="#c1" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gndr_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># gndr_df[&quot;Churn&quot;] = gndr_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># gndr_df[&quot;type&quot;] = gndr_df[&quot;Gender&quot;] + &quot;_&quot; + gndr_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Gender&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">gndr_df_lost</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># gndr_df_lost[&quot;ratio&quot;] = gndr_df_lost[&quot;cnt&quot;] / sum(gndr_df_lost[&quot;cnt&quot;])</span>


<span class="n">gndr_list</span> <span class="o">=</span>  <span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">gndr_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gndr_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gndr_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gndr_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gndr_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gndr_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gndr_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gndr_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">gndr_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">gndr_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gndr_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">gndr_df</span><span class="p">[(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gndr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gndr_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">gndr_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">gndr_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gndr_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">gndr_df</span>
<span class="n">gndr_df_lost</span>
<span class="n">gndr_list</span>
<span class="n">gndr_churn0_cnt</span><span class="p">;</span><span class="n">gndr_churn0_bg</span><span class="p">;</span><span class="n">gndr_churn0_wg</span>
<span class="n">gndr_churn1_cnt</span><span class="p">;</span><span class="n">gndr_churn1_bg</span><span class="p">;</span><span class="n">gndr_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gender</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Female</td>
      <td>0</td>
      <td>1898</td>
      <td>0.337123</td>
      <td>0.845058</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Female</td>
      <td>1</td>
      <td>348</td>
      <td>0.061812</td>
      <td>0.154942</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Male</td>
      <td>0</td>
      <td>2784</td>
      <td>0.494494</td>
      <td>0.822695</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Male</td>
      <td>1</td>
      <td>600</td>
      <td>0.106572</td>
      <td>0.177305</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gender</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Female</td>
      <td>348</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Male</td>
      <td>600</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Female&#39;, &#39;Male&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1898, 2784]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33.71, 49.45]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[84.51, 82.27]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[348, 600]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6.18, 10.66]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15.49, 17.73]
</pre></div>
</div>
</div>
</div>
</section>
<section id="c2">
<h3>c2 性别分布-可视化<a class="headerlink" href="#c2" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gndr_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">gndr_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">gndr_list</span><span class="p">)</span>
<span class="n">gndr_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gndr_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">gndr_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gndr_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">gndr_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">gndr_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;客户性别分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">gndr_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">gndr_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">gndr_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">gndr_list</span><span class="p">)</span>
<span class="n">gndr_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">gndr_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">gndr_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">gndr_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">gndr_bar_line</span> <span class="o">=</span> <span class="n">gndr_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">gndr_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">gndr_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662172c0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a75e2a1910&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a75e2a1910&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a75e2a1910&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="bd54d9dad8fe485fa3f498eefc02b7e5" style="width:1000px; height:600px;"></div>
    <script>
        var chart_bd54d9dad8fe485fa3f498eefc02b7e5 = echarts.init(
            document.getElementById('bd54d9dad8fe485fa3f498eefc02b7e5'), 'light', {renderer: 'canvas'});
        var option_bd54d9dad8fe485fa3f498eefc02b7e5 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                1898.0,
                2784.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                348.0,
                600.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Female",
                    33.71
                ],
                [
                    "Male",
                    49.45
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "Female",
                    6.18
                ],
                [
                    "Male",
                    10.66
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Female",
                "Male"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u5ba2\u6237\u6027\u522b\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_bd54d9dad8fe485fa3f498eefc02b7e5.setOption(option_bd54d9dad8fe485fa3f498eefc02b7e5);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gndr_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">gndr_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">gndr_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">gndr_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">gndr_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="f4e10f92b7ae43cfb6ab683cfd835391" style="width:900px; height:500px;"></div>
    <script>
        var chart_f4e10f92b7ae43cfb6ab683cfd835391 = echarts.init(
            document.getElementById('f4e10f92b7ae43cfb6ab683cfd835391'), 'light', {renderer: 'canvas'});
        var option_f4e10f92b7ae43cfb6ab683cfd835391 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                84.51,
                82.27
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                15.49,
                17.73
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "Female",
                "Male"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_f4e10f92b7ae43cfb6ab683cfd835391.setOption(option_f4e10f92b7ae43cfb6ab683cfd835391);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gndr_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">gndr_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="ed3292707b6f40459bdabf19120b8970" style="width:900px; height:500px;"></div>
    <script>
        var chart_ed3292707b6f40459bdabf19120b8970 = echarts.init(
            document.getElementById('ed3292707b6f40459bdabf19120b8970'), 'light', {renderer: 'canvas'});
        var option_ed3292707b6f40459bdabf19120b8970 = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "Female",
                    "value": 348
                },
                {
                    "name": "Male",
                    "value": 600
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "Female",
                "Male"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_ed3292707b6f40459bdabf19120b8970.setOption(option_ed3292707b6f40459bdabf19120b8970);
    </script>
</body>
</html>
</div></div>
</div>
</section>
<section id="d1">
<h3>d1 用户年龄-数据处理<a class="headerlink" href="#d1" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ageGrp_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># ageGrp_df[&quot;Churn&quot;] = ageGrp_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># ageGrp_df[&quot;type&quot;] = ageGrp_df[&quot;AgeGroup&quot;] + &quot;_&quot; + ageGrp_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">ageGrp_df_lost</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># ageGrp_df_lost[&quot;ratio&quot;] = ageGrp_df_lost[&quot;cnt&quot;] / sum(ageGrp_df_lost[&quot;cnt&quot;])</span>


<span class="n">ageGrp_list</span> <span class="o">=</span>  <span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">ageGrp_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ageGrp_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ageGrp_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ageGrp_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ageGrp_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ageGrp_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ageGrp_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ageGrp_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ageGrp_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ageGrp_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ageGrp_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ageGrp_df</span><span class="p">[(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ageGrp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ageGrp_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ageGrp_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ageGrp_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;AgeGroup&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ageGrp_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">ageGrp_df</span>
<span class="n">ageGrp_df_lost</span>
<span class="n">ageGrp_list</span>
<span class="n">ageGrp_churn0_cnt</span><span class="p">;</span><span class="n">ageGrp_churn0_bg</span><span class="p">;</span><span class="n">ageGrp_churn0_wg</span>
<span class="n">ageGrp_churn1_cnt</span><span class="p">;</span><span class="n">ageGrp_churn1_bg</span><span class="p">;</span><span class="n">ageGrp_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AgeGroup</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>213</td>
      <td>0.037833</td>
      <td>0.906383</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>22</td>
      <td>0.003908</td>
      <td>0.093617</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>250</td>
      <td>0.044405</td>
      <td>0.905797</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>1</td>
      <td>26</td>
      <td>0.004618</td>
      <td>0.094203</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>0</td>
      <td>1445</td>
      <td>0.256661</td>
      <td>0.850500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>1</td>
      <td>254</td>
      <td>0.045115</td>
      <td>0.149500</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>0</td>
      <td>1985</td>
      <td>0.352575</td>
      <td>0.835086</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>1</td>
      <td>392</td>
      <td>0.069627</td>
      <td>0.164914</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5</td>
      <td>0</td>
      <td>683</td>
      <td>0.121314</td>
      <td>0.775255</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5</td>
      <td>1</td>
      <td>198</td>
      <td>0.035169</td>
      <td>0.224745</td>
    </tr>
    <tr>
      <th>10</th>
      <td>6</td>
      <td>0</td>
      <td>106</td>
      <td>0.018828</td>
      <td>0.654321</td>
    </tr>
    <tr>
      <th>11</th>
      <td>6</td>
      <td>1</td>
      <td>56</td>
      <td>0.009947</td>
      <td>0.345679</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AgeGroup</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>26</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>254</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>392</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5</td>
      <td>198</td>
    </tr>
    <tr>
      <th>11</th>
      <td>6</td>
      <td>56</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[213, 250, 1445, 1985, 683, 106]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3.78, 4.44, 25.67, 35.26, 12.13, 1.88]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[90.64, 90.58, 85.05, 83.51, 77.53, 65.43]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[22, 26, 254, 392, 198, 56]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.39, 0.46, 4.51, 6.96, 3.52, 0.99]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9.36, 9.42, 14.95, 16.49, 22.47, 34.57]
</pre></div>
</div>
</div>
</div>
</section>
<section id="d2">
<h3>d2 用户年龄-数据可视化<a class="headerlink" href="#d2" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ageGrp</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">ageGrp</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">ageGrp_list</span><span class="p">)</span>
<span class="n">ageGrp</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ageGrp_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">ageGrp</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ageGrp_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">ageGrp</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">ageGrp</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;用户年龄分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">ageGrp</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">ageGrp_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">ageGrp_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">ageGrp_list</span><span class="p">)</span>
<span class="n">ageGrp_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">ageGrp_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">ageGrp_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">ageGrp_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">ageGrp_line</span> <span class="o">=</span> <span class="n">ageGrp</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">ageGrp_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">ageGrp_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7660a8f50&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767ed87a0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767ed87a0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767ed87a0&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="203df0823b624718b72b4f609cbc7b79" style="width:1000px; height:600px;"></div>
    <script>
        var chart_203df0823b624718b72b4f609cbc7b79 = echarts.init(
            document.getElementById('203df0823b624718b72b4f609cbc7b79'), 'light', {renderer: 'canvas'});
        var option_203df0823b624718b72b4f609cbc7b79 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                213.0,
                250.0,
                1445.0,
                1985.0,
                683.0,
                106.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                22.0,
                26.0,
                254.0,
                392.0,
                198.0,
                56.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1",
                    3.78
                ],
                [
                    "2",
                    4.44
                ],
                [
                    "3",
                    25.67
                ],
                [
                    "4",
                    35.26
                ],
                [
                    "5",
                    12.13
                ],
                [
                    "6",
                    1.88
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1",
                    0.39
                ],
                [
                    "2",
                    0.46
                ],
                [
                    "3",
                    4.51
                ],
                [
                    "4",
                    6.96
                ],
                [
                    "5",
                    3.52
                ],
                [
                    "6",
                    0.99
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5",
                "6"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u7528\u6237\u5e74\u9f84\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_203df0823b624718b72b4f609cbc7b79.setOption(option_203df0823b624718b72b4f609cbc7b79);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ageGrp_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">ageGrp_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">ageGrp_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">ageGrp_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">ageGrp_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="4385d51174674f7d8f35f942ec7aa543" style="width:900px; height:500px;"></div>
    <script>
        var chart_4385d51174674f7d8f35f942ec7aa543 = echarts.init(
            document.getElementById('4385d51174674f7d8f35f942ec7aa543'), 'light', {renderer: 'canvas'});
        var option_4385d51174674f7d8f35f942ec7aa543 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                90.64,
                90.58,
                85.05,
                83.51,
                77.53,
                65.43
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                9.36,
                9.42,
                14.95,
                16.49,
                22.47,
                34.57
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5",
                "6"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_4385d51174674f7d8f35f942ec7aa543.setOption(option_4385d51174674f7d8f35f942ec7aa543);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ageGrp_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">ageGrp_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="e539fab217d84c84934e0fe40d154ed3" style="width:900px; height:500px;"></div>
    <script>
        var chart_e539fab217d84c84934e0fe40d154ed3 = echarts.init(
            document.getElementById('e539fab217d84c84934e0fe40d154ed3'), 'light', {renderer: 'canvas'});
        var option_e539fab217d84c84934e0fe40d154ed3 = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "1",
                    "value": 22
                },
                {
                    "name": "2",
                    "value": 26
                },
                {
                    "name": "3",
                    "value": 254
                },
                {
                    "name": "4",
                    "value": 392
                },
                {
                    "name": "5",
                    "value": 198
                },
                {
                    "name": "6",
                    "value": 56
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5",
                "6"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_e539fab217d84c84934e0fe40d154ed3.setOption(option_e539fab217d84c84934e0fe40d154ed3);
    </script>
</body>
</html>
</div></div>
</div>
</section>
</section>
<section id="id7">
<h2>2.2 动态属性特征<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<section id="id8">
<h3>a1 服务满意度评级-数据处理<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stsfctnScr_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># stsfctnScr_df[&quot;Churn&quot;] = stsfctnScr_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># stsfctnScr_df[&quot;type&quot;] = stsfctnScr_df[&quot;SatisfactionScore&quot;] + &quot;_&quot; + stsfctnScr_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">stsfctnScr_df_lost</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># stsfctnScr_df_lost[&quot;ratio&quot;] = stsfctnScr_df_lost[&quot;cnt&quot;] / sum(stsfctnScr_df_lost[&quot;cnt&quot;])</span>


<span class="n">stsfctnScr_list</span> <span class="o">=</span>  <span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">stsfctnScr_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stsfctnScr_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stsfctnScr_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stsfctnScr_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stsfctnScr_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stsfctnScr_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stsfctnScr_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">stsfctnScr_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">stsfctnScr_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">stsfctnScr_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stsfctnScr_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">stsfctnScr_df</span><span class="p">[(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stsfctnScr_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">stsfctnScr_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">stsfctnScr_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">stsfctnScr_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">stsfctnScr_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">stsfctnScr_df</span>
<span class="n">stsfctnScr_df_lost</span>
<span class="n">stsfctnScr_list</span>
<span class="n">stsfctnScr_churn0_cnt</span><span class="p">;</span><span class="n">stsfctnScr_churn0_bg</span><span class="p">;</span><span class="n">stsfctnScr_churn0_wg</span>
<span class="n">stsfctnScr_churn1_cnt</span><span class="p">;</span><span class="n">stsfctnScr_churn1_bg</span><span class="p">;</span><span class="n">stsfctnScr_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SatisfactionScore</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1030</td>
      <td>0.182948</td>
      <td>0.884880</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>134</td>
      <td>0.023801</td>
      <td>0.115120</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>512</td>
      <td>0.090941</td>
      <td>0.873720</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>1</td>
      <td>74</td>
      <td>0.013144</td>
      <td>0.126280</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>0</td>
      <td>1406</td>
      <td>0.249734</td>
      <td>0.828033</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>1</td>
      <td>292</td>
      <td>0.051865</td>
      <td>0.171967</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>0</td>
      <td>890</td>
      <td>0.158082</td>
      <td>0.828678</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>1</td>
      <td>184</td>
      <td>0.032682</td>
      <td>0.171322</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5</td>
      <td>0</td>
      <td>844</td>
      <td>0.149911</td>
      <td>0.761733</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5</td>
      <td>1</td>
      <td>264</td>
      <td>0.046892</td>
      <td>0.238267</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SatisfactionScore</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>134</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>74</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>292</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>184</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5</td>
      <td>264</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1030, 512, 1406, 890, 844]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[18.29, 9.09, 24.97, 15.81, 14.99]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[88.49, 87.37, 82.8, 82.87, 76.17]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[134, 74, 292, 184, 264]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2.38, 1.31, 5.19, 3.27, 4.69]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11.51, 12.63, 17.2, 17.13, 23.83]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h3>a2 服务满意度评级-可视化<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stsfctnScr_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">stsfctnScr_list</span><span class="p">)</span>
<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stsfctnScr_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stsfctnScr_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;满意度得分&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">stsfctnScr_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">stsfctnScr_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">stsfctnScr_list</span><span class="p">)</span>
<span class="n">stsfctnScr_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">stsfctnScr_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">stsfctnScr_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">stsfctnScr_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">stsfctnScr_bar_line</span> <span class="o">=</span> <span class="n">stsfctnScr_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">stsfctnScr_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">stsfctnScr_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a7662177d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767f26780&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767f26780&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767f26780&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="8687a18894cd4d99b7d33cd7fc7cc78f" style="width:1000px; height:600px;"></div>
    <script>
        var chart_8687a18894cd4d99b7d33cd7fc7cc78f = echarts.init(
            document.getElementById('8687a18894cd4d99b7d33cd7fc7cc78f'), 'light', {renderer: 'canvas'});
        var option_8687a18894cd4d99b7d33cd7fc7cc78f = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                1030.0,
                512.0,
                1406.0,
                890.0,
                844.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                134.0,
                74.0,
                292.0,
                184.0,
                264.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1",
                    18.29
                ],
                [
                    "2",
                    9.09
                ],
                [
                    "3",
                    24.97
                ],
                [
                    "4",
                    15.81
                ],
                [
                    "5",
                    14.99
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1",
                    2.38
                ],
                [
                    "2",
                    1.31
                ],
                [
                    "3",
                    5.19
                ],
                [
                    "4",
                    3.27
                ],
                [
                    "5",
                    4.69
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u6ee1\u610f\u5ea6\u5f97\u5206",
            "left": "left"
        }
    ]
};
        chart_8687a18894cd4d99b7d33cd7fc7cc78f.setOption(option_8687a18894cd4d99b7d33cd7fc7cc78f);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stsfctnScr_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">stsfctnScr_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">stsfctnScr_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">stsfctnScr_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">stsfctnScr_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="5375cd6a9f66459499b7678d090d12d0" style="width:900px; height:500px;"></div>
    <script>
        var chart_5375cd6a9f66459499b7678d090d12d0 = echarts.init(
            document.getElementById('5375cd6a9f66459499b7678d090d12d0'), 'light', {renderer: 'canvas'});
        var option_5375cd6a9f66459499b7678d090d12d0 = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                88.49,
                87.37,
                82.8,
                82.87,
                76.17
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                11.51,
                12.63,
                17.2,
                17.13,
                23.83
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_5375cd6a9f66459499b7678d090d12d0.setOption(option_5375cd6a9f66459499b7678d090d12d0);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stsfctnScr_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">stsfctnScr_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="ec6aad3301e94778b3ad41a8937b2fa9" style="width:900px; height:500px;"></div>
    <script>
        var chart_ec6aad3301e94778b3ad41a8937b2fa9 = echarts.init(
            document.getElementById('ec6aad3301e94778b3ad41a8937b2fa9'), 'light', {renderer: 'canvas'});
        var option_ec6aad3301e94778b3ad41a8937b2fa9 = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "1",
                    "value": 134
                },
                {
                    "name": "2",
                    "value": 74
                },
                {
                    "name": "3",
                    "value": 292
                },
                {
                    "name": "4",
                    "value": 184
                },
                {
                    "name": "5",
                    "value": 264
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_ec6aad3301e94778b3ad41a8937b2fa9.setOption(option_ec6aad3301e94778b3ad41a8937b2fa9);
    </script>
</body>
</html>
</div></div>
</div>
</section>
<section id="b1-app">
<h3>b1 APP使用时长-数据处理<a class="headerlink" href="#b1-app" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HurSpndOnApp_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># HurSpndOnApp_df[&quot;Churn&quot;] = HurSpndOnApp_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># HurSpndOnApp_df[&quot;type&quot;] = HurSpndOnApp_df[&quot;HourSpendOnApp&quot;] + &quot;_&quot; + HurSpndOnApp_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">HurSpndOnApp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HurSpndOnApp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">HurSpndOnApp_df_lost</span> <span class="o">=</span> <span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="n">HurSpndOnApp_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;HourSpendOnApp&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># HurSpndOnApp_df_lost[&quot;ratio&quot;] = HurSpndOnApp_df_lost[&quot;cnt&quot;] / sum(HurSpndOnApp_df_lost[&quot;cnt&quot;])</span>

<span class="n">HurSpndOnApp_df</span>
<span class="n">HurSpndOnApp_df_lost</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HourSpendOnApp</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0</td>
      <td>3</td>
      <td>0.000533</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0</td>
      <td>35</td>
      <td>0.006217</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>0</td>
      <td>1239</td>
      <td>0.220071</td>
      <td>0.842284</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>1</td>
      <td>232</td>
      <td>0.041208</td>
      <td>0.157716</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.0</td>
      <td>0</td>
      <td>2424</td>
      <td>0.430551</td>
      <td>0.823929</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.0</td>
      <td>1</td>
      <td>518</td>
      <td>0.092007</td>
      <td>0.176071</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.0</td>
      <td>0</td>
      <td>978</td>
      <td>0.173712</td>
      <td>0.831633</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4.0</td>
      <td>1</td>
      <td>198</td>
      <td>0.035169</td>
      <td>0.168367</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.0</td>
      <td>0</td>
      <td>3</td>
      <td>0.000533</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HourSpendOnApp</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>232</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.0</td>
      <td>518</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4.0</td>
      <td>198</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id10">
<h3>c1 上月客诉-数据处理<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmpln_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Complain&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># cmpln_df[&quot;Churn&quot;] = cmpln_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># cmpln_df[&quot;type&quot;] = cmpln_df[&quot;Complain&quot;] + &quot;_&quot; + cmpln_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Complain&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">cmpln_df_lost</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;Complain&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># cmpln_df_lost[&quot;ratio&quot;] = cmpln_df_lost[&quot;cnt&quot;] / sum(cmpln_df_lost[&quot;cnt&quot;])</span>


<span class="n">cmpln_list</span> <span class="o">=</span>  <span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cmpln_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmpln_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmpln_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmpln_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmpln_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmpln_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmpln_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cmpln_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">cmpln_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">cmpln_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmpln_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">cmpln_df</span><span class="p">[(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cmpln_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cmpln_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">cmpln_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">cmpln_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cmpln_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">cmpln_df</span>
<span class="n">cmpln_df_lost</span>
<span class="n">cmpln_list</span>
<span class="n">cmpln_churn0_cnt</span><span class="p">;</span><span class="n">cmpln_churn0_bg</span><span class="p">;</span><span class="n">cmpln_churn0_wg</span>
<span class="n">cmpln_churn1_cnt</span><span class="p">;</span><span class="n">cmpln_churn1_bg</span><span class="p">;</span><span class="n">cmpln_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Complain</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>3586</td>
      <td>0.636945</td>
      <td>0.890710</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>440</td>
      <td>0.078153</td>
      <td>0.109290</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>1096</td>
      <td>0.194671</td>
      <td>0.683292</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>508</td>
      <td>0.090231</td>
      <td>0.316708</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Complain</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>440</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>508</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;0&#39;, &#39;1&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3586, 1096]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[63.69, 19.47]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[89.07, 68.33]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[440, 508]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7.82, 9.02]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10.93, 31.67]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id11">
<h3>c2 上月客诉-可视化<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmpln_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">cmpln_list</span><span class="p">)</span>
<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmpln_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmpln_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;客诉分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">cmpln_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">cmpln_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">cmpln_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">cmpln_list</span><span class="p">)</span>
<span class="n">cmpln_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">cmpln_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">cmpln_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">cmpln_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">cmpln_bar_line</span> <span class="o">=</span> <span class="n">cmpln_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">cmpln_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">cmpln_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767f26a20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766215880&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766215880&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a766215880&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="2a477493e47a41738ee52a2bf5f59a1f" style="width:1000px; height:600px;"></div>
    <script>
        var chart_2a477493e47a41738ee52a2bf5f59a1f = echarts.init(
            document.getElementById('2a477493e47a41738ee52a2bf5f59a1f'), 'light', {renderer: 'canvas'});
        var option_2a477493e47a41738ee52a2bf5f59a1f = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                3586.0,
                1096.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                440.0,
                508.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "0",
                    63.69
                ],
                [
                    "1",
                    19.47
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "0",
                    7.82
                ],
                [
                    "1",
                    9.02
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "0",
                "1"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u5ba2\u8bc9\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_2a477493e47a41738ee52a2bf5f59a1f.setOption(option_2a477493e47a41738ee52a2bf5f59a1f);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmpln_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">cmpln_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">cmpln_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">cmpln_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">cmpln_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="a9cf029e526a4e688cd12574399ebaab" style="width:900px; height:500px;"></div>
    <script>
        var chart_a9cf029e526a4e688cd12574399ebaab = echarts.init(
            document.getElementById('a9cf029e526a4e688cd12574399ebaab'), 'light', {renderer: 'canvas'});
        var option_a9cf029e526a4e688cd12574399ebaab = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                89.07,
                68.33
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                10.93,
                31.67
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "0",
                "1"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_a9cf029e526a4e688cd12574399ebaab.setOption(option_a9cf029e526a4e688cd12574399ebaab);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmpln_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">cmpln_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="534ce9cb2d844f36b4fb8443b08658de" style="width:900px; height:500px;"></div>
    <script>
        var chart_534ce9cb2d844f36b4fb8443b08658de = echarts.init(
            document.getElementById('534ce9cb2d844f36b4fb8443b08658de'), 'light', {renderer: 'canvas'});
        var option_534ce9cb2d844f36b4fb8443b08658de = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "0",
                    "value": 440
                },
                {
                    "name": "1",
                    "value": 508
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "0",
                "1"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_534ce9cb2d844f36b4fb8443b08658de.setOption(option_534ce9cb2d844f36b4fb8443b08658de);
    </script>
</body>
</html>
</div></div>
</div>
</section>
<section id="id12">
<h3>d1 关注的主播总数-数据处理<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmbrFllwd_df</span> <span class="o">=</span> <span class="n">euc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">))</span>
<span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># nmbrFllwd_df[&quot;Churn&quot;] = nmbrFllwd_df[&quot;Churn&quot;].astype(&quot;str&quot;)</span>
<span class="c1"># nmbrFllwd_df[&quot;type&quot;] = nmbrFllwd_df[&quot;NumberOfStreamerFollowed_group&quot;] + &quot;_&quot; + nmbrFllwd_df[&quot;Churn&quot;]</span>
<span class="n">wg_totals</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">)[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wg_totals</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">nmbrFllwd_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nmbrFllwd_df</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">:</span> <span class="s2">&quot;16-20&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b/g&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;w/g&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">:</span> <span class="s2">&quot;21-25&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b/g&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;w/g&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nmbrFllwd_df_lost</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">,</span> <span class="s2">&quot;cnt&quot;</span><span class="p">]]</span>
<span class="c1"># nmbrFllwd_df_lost[&quot;ratio&quot;] = nmbrFllwd_df_lost[&quot;cnt&quot;] / sum(nmbrFllwd_df_lost[&quot;cnt&quot;])</span>


<span class="n">nmbrFllwd_list</span> <span class="o">=</span>  <span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">nmbrFllwd_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nmbrFllwd_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">nmbrFllwd_churn0_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nmbrFllwd_churn0_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nmbrFllwd_churn0_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nmbrFllwd_churn1_cnt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nmbrFllwd_churn1_bg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nmbrFllwd_churn1_wg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nmbrFllwd_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nmbrFllwd_churn0_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">nmbrFllwd_churn0_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">nmbrFllwd_churn0_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nmbrFllwd_list</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">nmbrFllwd_df</span><span class="p">[(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nmbrFllwd_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;w/g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nmbrFllwd_churn1_cnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">nmbrFllwd_churn1_bg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">nmbrFllwd_churn1_wg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pie_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;NumberOfStreamerFollowed_group&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">nmbrFllwd_df_lost</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="n">nmbrFllwd_df</span>
<span class="n">nmbrFllwd_df_lost</span>
<span class="n">nmbrFllwd_list</span>
<span class="n">nmbrFllwd_churn0_cnt</span><span class="p">;</span><span class="n">nmbrFllwd_churn0_bg</span><span class="p">;</span><span class="n">nmbrFllwd_churn0_wg</span>
<span class="n">nmbrFllwd_churn1_cnt</span><span class="p">;</span><span class="n">nmbrFllwd_churn1_bg</span><span class="p">;</span><span class="n">nmbrFllwd_churn1_wg</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NumberOfStreamerFollowed_group</th>
      <th>Churn</th>
      <th>cnt</th>
      <th>b/g</th>
      <th>w/g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1-5</td>
      <td>0</td>
      <td>3531</td>
      <td>0.627176</td>
      <td>0.845344</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1-5</td>
      <td>1</td>
      <td>646</td>
      <td>0.114742</td>
      <td>0.154656</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11-15</td>
      <td>0</td>
      <td>75</td>
      <td>0.013321</td>
      <td>0.765306</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11-15</td>
      <td>1</td>
      <td>23</td>
      <td>0.004085</td>
      <td>0.234694</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16-20</td>
      <td>1</td>
      <td>2</td>
      <td>0.000355</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21-25</td>
      <td>0</td>
      <td>2</td>
      <td>0.000355</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6-10</td>
      <td>0</td>
      <td>1074</td>
      <td>0.190764</td>
      <td>0.794967</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6-10</td>
      <td>1</td>
      <td>277</td>
      <td>0.049201</td>
      <td>0.205033</td>
    </tr>
    <tr>
      <th>8</th>
      <td>16-20</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>21-25</td>
      <td>1</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NumberOfStreamerFollowed_group</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1-5</td>
      <td>646</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11-15</td>
      <td>23</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16-20</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6-10</td>
      <td>277</td>
    </tr>
    <tr>
      <th>9</th>
      <td>21-25</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1-5&#39;, &#39;6-10&#39;, &#39;11-15&#39;, &#39;16-20&#39;, &#39;21-25&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3531, 1074, 75, 0, 2]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[62.72, 19.08, 1.33, 0.0, 0.04]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[84.53, 79.5, 76.53, 0.0, 100.0]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[646, 277, 23, 2, 0]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[11.47, 4.92, 0.41, 0.04, 0.0]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[15.47, 20.5, 23.47, 100.0, 0.0]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id13">
<h3>d2 关注的主播总数-可视化<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmbrFllwd_bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1000px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">))</span>
<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">nmbrFllwd_list</span><span class="p">)</span>
<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nmbrFllwd_churn0_cnt</span><span class="p">]</span> <span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nmbrFllwd_churn1_cnt</span><span class="p">],</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>

<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">extend_axis</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;占比(%)&quot;</span><span class="p">,</span>
        <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">%&quot;</span><span class="p">),</span>
        <span class="n">splitline_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">SplitLineOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;关注主播数量分析&quot;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
    <span class="n">yaxis_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">AxisOpts</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;数量&quot;</span><span class="p">,</span>
        <span class="n">axislabel_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_right</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pos_top</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&quot;cross&quot;</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">nmbrFllwd_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
<span class="n">nmbrFllwd_line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">nmbrFllwd_list</span><span class="p">)</span>
<span class="n">nmbrFllwd_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;未流失&quot;</span><span class="p">,</span> 
    <span class="n">nmbrFllwd_churn0_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">nmbrFllwd_line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span>
    <span class="s2">&quot;已流失&quot;</span><span class="p">,</span> 
    <span class="n">nmbrFllwd_churn1_bg</span><span class="p">,</span> 
    <span class="n">yaxis_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">is_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value[1] + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> 
        <span class="n">is_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">),</span>
    <span class="n">linestyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LineStyleOpts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="n">symbol_size</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">nmbrFllwd_bar_line</span> <span class="o">=</span> <span class="n">nmbrFllwd_bar</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">nmbrFllwd_line</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">nmbrFllwd_bar_line</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.bar.Bar at 0x2a767ed9b20&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767e496d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767e496d0&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyecharts.charts.basic_charts.line.Line at 0x2a767e496d0&gt;
</pre></div>
</div>
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="5cd82e1dec024e33a952b45b07d5e37a" style="width:1000px; height:600px;"></div>
    <script>
        var chart_5cd82e1dec024e33a952b45b07d5e37a = echarts.init(
            document.getElementById('5cd82e1dec024e33a952b45b07d5e37a'), 'light', {renderer: 'canvas'});
        var option_5cd82e1dec024e33a952b45b07d5e37a = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                3531.0,
                1074.0,
                75.0,
                0.0,
                2.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                646.0,
                277.0,
                23.0,
                2.0,
                0.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "inside",
                "color": "black",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "line",
            "name": "\u672a\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1-5",
                    62.72
                ],
                [
                    "6-10",
                    19.08
                ],
                [
                    "11-15",
                    1.33
                ],
                [
                    "16-20",
                    0.0
                ],
                [
                    "21-25",
                    0.04
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        },
        {
            "type": "line",
            "name": "\u5df2\u6d41\u5931",
            "connectNulls": false,
            "yAxisIndex": 1,
            "symbol": "circle",
            "symbolSize": 10,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "1-5",
                    11.47
                ],
                [
                    "6-10",
                    4.92
                ],
                [
                    "11-15",
                    0.41
                ],
                [
                    "16-20",
                    0.04
                ],
                [
                    "21-25",
                    0.0
                ]
            ],
            "label": {
                "show": true,
                "position": "bottom",
                "color": "black",
                "margin": 8,
                "formatter": function (params) {return params.value[1] + '%';}
            },
            "lineStyle": {
                "width": 3,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931",
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            },
            "show": true,
            "right": 20,
            "top": 20
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "axis",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "cross"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1-5",
                "6-10",
                "11-15",
                "16-20",
                "21-25"
            ]
        }
    ],
    "yAxis": [
        {
            "name": "\u6570\u91cf",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        },
        {
            "type": "value",
            "name": "\u5360\u6bd4(%)",
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "axisLabel": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{value}%"
            },
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "min": 0,
            "max": 90,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u5173\u6ce8\u4e3b\u64ad\u6570\u91cf\u5206\u6790",
            "left": "left"
        }
    ]
};
        chart_5cd82e1dec024e33a952b45b07d5e37a.setOption(option_5cd82e1dec024e33a952b45b07d5e37a);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmbrFllwd_stack_bar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">nmbrFllwd_list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;未流失&quot;</span><span class="p">,</span> <span class="n">nmbrFllwd_churn0_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&quot;已流失&quot;</span><span class="p">,</span> <span class="n">nmbrFllwd_churn1_wg</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s2">&quot;stack1&quot;</span><span class="p">,</span> <span class="n">category_gap</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_series_opts</span><span class="p">(</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">JsCode</span><span class="p">(</span><span class="s2">&quot;function (params) {return params.value.toFixed(2) + &#39;%&#39;;}&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">nmbrFllwd_stack_bar</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="2612ff965db84bed9dbe4f5e589f2f1c" style="width:900px; height:500px;"></div>
    <script>
        var chart_2612ff965db84bed9dbe4f5e589f2f1c = echarts.init(
            document.getElementById('2612ff965db84bed9dbe4f5e589f2f1c'), 'light', {renderer: 'canvas'});
        var option_2612ff965db84bed9dbe4f5e589f2f1c = {
    "series": [
        {
            "type": "bar",
            "name": "\u672a\u6d41\u5931",
            "data": [
                84.53,
                79.5,
                76.53,
                0.0,
                100.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        },
        {
            "type": "bar",
            "name": "\u5df2\u6d41\u5931",
            "data": [
                15.47,
                20.5,
                23.47,
                100.0,
                0.0
            ],
            "stack": "stack1",
            "barCategoryGap": "50%",
            "label": {
                "show": true,
                "position": "right",
                "margin": 8,
                "formatter": function (params) {return params.value.toFixed(2) + '%';}
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u672a\u6d41\u5931",
                "\u5df2\u6d41\u5931"
            ],
            "selected": {
                "\u672a\u6d41\u5931": true,
                "\u5df2\u6d41\u5931": true
            }
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1-5",
                "6-10",
                "11-15",
                "16-20",
                "21-25"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ]
};
        chart_2612ff965db84bed9dbe4f5e589f2f1c.setOption(option_2612ff965db84bed9dbe4f5e589f2f1c);
    </script>
</body>
</html>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmbrFllwd_pie</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Pie</span><span class="p">(</span><span class="n">init_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">InitOpts</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">ThemeType</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">data_pair</span><span class="o">=</span><span class="n">pie_data</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="s2">&quot;70%&quot;</span><span class="p">],</span>
        <span class="n">label_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LabelOpts</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2"> (</span><span class="si">{d}</span><span class="s2">%)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">),</span>
        <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{b}</span><span class="s2">: </span><span class="si">{c}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">nmbrFllwd_pie</span><span class="o">.</span><span class="n">render_embed</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

</head>
<body>
    <div id="74a8e05d53fd49a894ea00a6f2e652a8" style="width:900px; height:500px;"></div>
    <script>
        var chart_74a8e05d53fd49a894ea00a6f2e652a8 = echarts.init(
            document.getElementById('74a8e05d53fd49a894ea00a6f2e652a8'), 'light', {renderer: 'canvas'});
        var option_74a8e05d53fd49a894ea00a6f2e652a8 = {
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "1-5",
                    "value": 646
                },
                {
                    "name": "11-15",
                    "value": 23
                },
                {
                    "name": "16-20",
                    "value": 2
                },
                {
                    "name": "6-10",
                    "value": 277
                },
                {
                    "name": "21-25",
                    "value": 0
                }
            ],
            "radius": [
                "40%",
                "70%"
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "outside",
                "color": "black",
                "margin": 8,
                "formatter": "{b}: {c} ({d}%)"
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "formatter": "{b}: {c}",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0
            }
        }
    ],
    "legend": [
        {
            "data": [
                "1-5",
                "11-15",
                "16-20",
                "6-10",
                "21-25"
            ],
            "selected": {},
            "show": true
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {}
    ]
};
        chart_74a8e05d53fd49a894ea00a6f2e652a8.setOption(option_74a8e05d53fd49a894ea00a6f2e652a8);
    </script>
</body>
</html>
</div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id14">
<h1>三、特征与流失相关性<a class="headerlink" href="#id14" title="Link to this heading">#</a></h1>
<section id="id15">
<h2>3.1 相关性分析<a class="headerlink" href="#id15" title="Link to this heading">#</a></h2>
<section id="pearson-cramer-s-v">
<h3>对数据进行编码后采用默认的pearson，这种方法具有一定的局限性，所以后续结合随机森林来确定哪些特征进入模型。<br>效果不好的情况可以采用点二列相关系数、Cramer”s V系数或者综合用互信息等相关方法<a class="headerlink" href="#pearson-cramer-s-v" title="Link to this heading">#</a></h3>
</section>
<section id="id16">
<h3>3.1.1 读取处理之后的数据<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;./data/clean.xlsx&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">euc_df1</span><span class="p">[</span><span class="s2">&quot;CustomerID&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="id17">
<h3>3.1.2 对分类变量进行独热编码<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df1_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">euc_df1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">euc_df1</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="id18">
<h3>3.1.3 计算相关性<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">euc_df1_encoded</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Churn&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tenure                                 0.315941
Complain                               0.250188
MaritalStatus_Single                   0.180847
DaySinceLastOrder                      0.155871
PreferedOrderCat_Mobile Phone          0.154387
DiscountAmount                         0.154118
MaritalStatus_Married                  0.151024
PreferedOrderCat_Laptop &amp; Accessory    0.133353
PreferedOrderCat_Household             0.113364
PreferredLoginDevice_Mobile Phone      0.111639
AgeGroup                               0.107939
SatisfactionScore                      0.105481
PreferedOrderCat_Grocery               0.089575
CityTier                               0.084703
PreferredLoginDevice_Phone             0.078916
WarehouseToHome                        0.069544
PreferedOrderCat_Others                0.054903
PreferredLoginDevice_Pad               0.051099
NumberOfStreamerFollowed               0.043931
Gender_Male                            0.029264
Gender_Female                          0.029264
MaritalStatus_Divorced                 0.024934
HourSpendOnApp                         0.018816
OrderCount                             0.015327
PreferedOrderCat_Fashion               0.014871
OrderAmountHikeFromlastYear            0.007075
CouponUsed                             0.001430
Name: Churn, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="id19">
<h3>3.1.4 使用随机森林来筛选重要特征<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<section id="id20">
<h4>查看数据样本是否均衡<a class="headerlink" href="#id20" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df1_encoded</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">euc_df1_encoded</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">euc_df1_encoded</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Churn
0    4682
1     948
Name: count, dtype: int64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.20247757368645877
</pre></div>
</div>
</div>
</div>
</section>
<section id="id21">
<h4>数据存在轻微不平衡 可以先不处理，后续模型表现不佳的情况可以重新处理<a class="headerlink" href="#id21" title="Link to this heading">#</a></h4>
</section>
<section id="id22">
<h4>打乱数据<a class="headerlink" href="#id22" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">euc_df1_encoded</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">Ind</span><span class="p">)</span>
<span class="n">euc_df1_encoded</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">Ind</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">euc_df1_encoded</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Churn&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">euc_df1_encoded</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=42)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">importances</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_10_features</span> <span class="o">=</span> <span class="n">feature_importance</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;与 Churn 的相关性&quot;</span><span class="p">:</span> <span class="n">corr</span><span class="p">,</span>
    <span class="s2">&quot;重要性排名前 5 的特征&quot;</span><span class="p">:</span> <span class="n">top_10_features</span>
<span class="p">}</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;与 Churn 的相关性&#39;: Tenure                                -0.315941
 CityTier                               0.084703
 WarehouseToHome                        0.069544
 AgeGroup                               0.107939
 HourSpendOnApp                         0.018816
 OrderCount                            -0.015327
 OrderAmountHikeFromlastYear           -0.007075
 DaySinceLastOrder                     -0.155871
 NumberOfStreamerFollowed               0.043931
 SatisfactionScore                      0.105481
 Complain                               0.250188
 CouponUsed                            -0.001430
 DiscountAmount                        -0.154118
 PreferredLoginDevice_Mobile Phone     -0.111639
 PreferredLoginDevice_Pad               0.051099
 PreferredLoginDevice_Phone             0.078916
 MaritalStatus_Divorced                -0.024934
 MaritalStatus_Married                 -0.151024
 MaritalStatus_Single                   0.180847
 Gender_Female                         -0.029264
 Gender_Male                            0.029264
 PreferedOrderCat_Fashion              -0.014871
 PreferedOrderCat_Grocery              -0.089575
 PreferedOrderCat_Household             0.113364
 PreferedOrderCat_Laptop &amp; Accessory   -0.133353
 PreferedOrderCat_Mobile Phone          0.154387
 PreferedOrderCat_Others               -0.054903
 Name: Churn, dtype: float64,
 &#39;重要性排名前 5 的特征&#39;: Index([&#39;Tenure&#39;, &#39;DiscountAmount&#39;, &#39;WarehouseToHome&#39;, &#39;DaySinceLastOrder&#39;,
        &#39;NumberOfStreamerFollowed&#39;, &#39;OrderAmountHikeFromlastYear&#39;, &#39;Complain&#39;,
        &#39;SatisfactionScore&#39;, &#39;OrderCount&#39;, &#39;AgeGroup&#39;],
       dtype=&#39;object&#39;)}
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id23">
<h1>四、客户画像–基于筛选出的重要特征构建已流失客户的客户画像<a class="headerlink" href="#id23" title="Link to this heading">#</a></h1>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euc_df_churned</span> <span class="o">=</span> <span class="n">euc_df</span><span class="p">[</span><span class="n">euc_df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">,</span> <span class="s2">&quot;DiscountAmount&quot;</span><span class="p">,</span> <span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">,</span> <span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">,</span> <span class="s2">&quot;NumberOfStreamerFollowed&quot;</span><span class="p">,</span> 
                    <span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">,</span> <span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderCount&quot;</span><span class="p">,</span> <span class="s2">&quot;AgeGroup&quot;</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span>

<span class="n">numeric_stats</span> <span class="o">=</span> <span class="n">euc_df_churned</span><span class="p">[</span><span class="n">numeric_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">complain_counts</span> <span class="o">=</span> <span class="n">euc_df_churned</span><span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;数值型特征的描述性统计：&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">numeric_stats</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">是否投诉的分布情况：&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">complain_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>数值型特征的描述性统计：
       Tenure  DiscountAmount  WarehouseToHome  DaySinceLastOrder  \
count  948.00          948.00           948.00             948.00   
mean     4.82          160.37            16.86               3.22   
std      5.24           38.44             8.29               3.32   
min      1.00          110.09             5.00               0.00   
25%      1.00          132.02            10.00               1.00   
50%      3.00          149.66            14.00               2.50   
75%      7.00          174.69            22.00               4.00   
max     23.00          323.59            36.00              46.00   

       NumberOfStreamerFollowed  OrderAmountHikeFromlastYear  OrderCount  
count                    948.00                       948.00      948.00  
mean                       4.47                        15.62        2.77  
std                        2.79                         3.78        2.81  
min                        1.00                        11.00        0.00  
25%                        2.00                        13.00        1.00  
50%                        3.00                        15.00        2.00  
75%                        6.00                        18.00        3.00  
max                       20.00                        26.00       16.00  

是否投诉的分布情况：
Complain
1    508
0    440
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<section id="id24">
<h2>4.1.1 已流失客户的客户画像概述<a class="headerlink" href="#id24" title="Link to this heading">#</a></h2>
<p><br>总体情况
<br>已流失客户样本数量为 948 个。
<br>数值型特征分析
<br><strong>使用时长（Tenure）</strong>
<br> 平均使用时长约为 4.82 ，标准差 5.24，说明使用时长差异较大。
<br> 最小值为 1，最大值为 23，25% 分位数为 1，50% 分位数为 3，75% 分位数为 7，这表明大部分已流失客户使用时长较短。
<br><strong>折扣金额（DiscountAmount）</strong>
<br> 平均折扣金额约为 160.37，标准差 38.44，波动相对较小。
<br> 最小值 110.09，最大值 323.59，说明不同客户享受的折扣金额有一定差距。
<br><strong>仓库到家距离（WarehouseToHome）</strong>
<br> 平均距离约 16.86，标准差 8.29，距离有一定离散性。
<br> 最小值 5，最大值 36，25% 分位数 10，50% 分位数 14，75% 分位数 22，多数客户距离在 10 - 22 之间。
<br><strong>上次下单至今天数（DaySinceLastOrder）</strong>
<br> 平均约 3.22 天，标准差 3.32，差异较大。
<br> 最小值 0，最大值 46，大部分客户在 1 - 4 天内有下单行为，但存在少数长时间未下单的客户。
<br><strong>关注主播数量（NumberOfStreamerFollowed）</strong>
<br> 平均约 4.47 个，标准差 2.79，分布较为集中。
<br> 最小值 1，最大值 20，多数客户关注 2 - 6 个主播。
<br><strong>订单金额年增长幅度（OrderAmountHikeFromlastYear）</strong>
<br> 平均增长约 15.62，标准差 3.78，增长幅度较为稳定。
<br> 最小值 11，最大值 26，大部分客户增长幅度在 13 - 18 之间。
<br><strong>满意度评分（SatisfactionScore）</strong>
<br> 平均评分为 3.39，标准差 1.34，整体满意度中等。
<br> 最小值 1，最大值 5，25% 和 50% 分位数均为 3，说明有较多客户给出 3 分的评价。
<br><strong>订单数量（OrderCount）</strong>
<br> 平均订单数约 2.77，标准差 2.81，订单数量差异较大。
<br> 最小值 0，最大值 16，多数客户订单数在 1 - 3 单。
<br><strong>年龄组（AgeGroup）</strong>
<br> 平均年龄组约为 3.93，标准差 1.01，年龄分布相对集中。
<br> 最小值 1，最大值 6，25% 分位数 3，50% 分位数 4，75% 分位数 5，说明已流失客户主要集中在 3 - 5 年龄组。
<br>分类型特征分析
<br><strong>是否投诉（Complain）</strong>
<br> 在已流失客户中，有 508 人投诉过，440 人未投诉过。投诉人数略多于未投诉人数，说明投诉情况可能是导致客户流失的一个重要因素。
<br>综合来看，<strong>已流失客户多为在 3 - 5 年龄组、使用时长较短、满意度中等、订单数量较少的群体，且投诉情况对客户流失有一定影响</strong>。可以针对这些特点进一步分析原因，如优化服务、提高客户满意度、增加用户粘性等，以减少客户流失。</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id25">
<h1>五、建立客户流失预测模型<a class="headerlink" href="#id25" title="Link to this heading">#</a></h1>
<section id="gbdtadaboostlightgbm-svm">
<h2>5.1.1 对比各种逻辑回归、决策树、随机森林、GBDT、adaboost、LightGBM、朴素贝叶斯，svm算法的表现<a class="headerlink" href="#gbdtadaboostlightgbm-svm" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Tenure&quot;</span><span class="p">,</span> <span class="s2">&quot;DiscountAmount&quot;</span><span class="p">,</span> <span class="s2">&quot;WarehouseToHome&quot;</span><span class="p">,</span> <span class="s2">&quot;DaySinceLastOrder&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NumberOfStreamerFollowed&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderAmountHikeFromlastYear&quot;</span><span class="p">,</span> <span class="s2">&quot;Complain&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SatisfactionScore&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderCount&quot;</span><span class="p">,</span> <span class="s2">&quot;AgeGroup&quot;</span><span class="p">,</span> <span class="s2">&quot;Churn&quot;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;./data/clean.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span>

<span class="n">Ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">Ind</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">Ind</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Churn&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Churn&quot;</span><span class="p">]</span>

<span class="c1"># 先看各个模型表现情况 如果表现不佳则考虑处理样本均衡的问题</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;GBDT&quot;</span><span class="p">:</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;AdaBoost&quot;</span><span class="p">:</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;LightGBM&quot;</span><span class="p">:</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;Naive Bayes&quot;</span><span class="p">:</span> <span class="n">GaussianNB</span><span class="p">(),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>


<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
        <span class="n">X_tr</span> <span class="o">=</span> <span class="n">X_train_scaled</span>
        <span class="n">X_te</span> <span class="o">=</span> <span class="n">X_test_scaled</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X_tr</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="n">X_te</span> <span class="o">=</span> <span class="n">X_test</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_tr</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_te</span><span class="p">)</span>
    <span class="n">y_prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_te</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">auc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
        <span class="s2">&quot;ROC AUC&quot;</span><span class="p">:</span> <span class="n">auc</span>
    <span class="p">})</span>


<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;ROC AUC&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;模型性能比较:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=1000, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(max_iter=1000, random_state=42)</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;DecisionTreeClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.tree.DecisionTreeClassifier.html">?<span>Documentation for DecisionTreeClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeClassifier(random_state=42)</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=42)</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GradientBoostingClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GradientBoostingClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>AdaBoostClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;AdaBoostClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.AdaBoostClassifier.html">?<span>Documentation for AdaBoostClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>AdaBoostClassifier(random_state=42)</pre></div> </div></div></div></div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[LightGBM] [Info] Number of positive: 664, number of negative: 3277
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000067 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 402
[LightGBM] [Info] Number of data points in the train set: 3941, number of used features: 10
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.168485 -&gt; initscore=-1.596401
[LightGBM] [Info] Start training from score -1.596401
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-7 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-7 {
  color: var(--sklearn-color-text);
}

#sk-container-id-7 pre {
  padding: 0;
}

#sk-container-id-7 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-7 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-7 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-7 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-7 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-7 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-7 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-7 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-7 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-7 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-7 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-7 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-7 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-7 div.sk-label label.sk-toggleable__label,
#sk-container-id-7 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-7 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-7 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-7 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-7 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-7 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-7 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-7 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-7 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-7 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LGBMClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" checked><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LGBMClassifier<span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>LGBMClassifier(random_state=42)</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-8 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-8 {
  color: var(--sklearn-color-text);
}

#sk-container-id-8 pre {
  padding: 0;
}

#sk-container-id-8 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-8 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-8 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-8 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-8 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-8 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-8 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-8 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-8 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-8 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-8 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-8 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-8 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-8 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-8 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-8 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-8 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-8 div.sk-label label.sk-toggleable__label,
#sk-container-id-8 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-8 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-8 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-8 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-8 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-8 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-8 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-8 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-8 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-8 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-8 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-8" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" checked><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GaussianNB<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.naive_bayes.GaussianNB.html">?<span>Documentation for GaussianNB</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GaussianNB()</pre></div> </div></div></div></div></div><div class="output text_html"><style>#sk-container-id-9 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-9 {
  color: var(--sklearn-color-text);
}

#sk-container-id-9 pre {
  padding: 0;
}

#sk-container-id-9 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-9 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-9 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-9 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-9 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-9 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-9 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-9 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-9 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-9 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-9 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-9 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-9 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-9 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-9 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-9 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-9 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-9 div.sk-label label.sk-toggleable__label,
#sk-container-id-9 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-9 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-9 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-9 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-9 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-9 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-9 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-9 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-9 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-9 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-9 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-9" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SVC(probability=True, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" checked><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;SVC<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.svm.SVC.html">?<span>Documentation for SVC</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>SVC(probability=True, random_state=42)</pre></div> </div></div></div></div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>模型性能比较:
              Model  Accuracy  ROC AUC
      Random Forest  0.960332 0.983337
           LightGBM  0.937241 0.970871
               GBDT  0.898165 0.916931
                SVM  0.889876 0.899499
      Decision Tree  0.944346 0.897718
           AdaBoost  0.881587 0.889261
Logistic Regression  0.857904 0.838171
        Naive Bayes  0.828893 0.800233
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_name</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">best_model_name</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">初始最佳模型: </span><span class="si">{</span><span class="n">best_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>初始最佳模型: Random Forest
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">开始对 </span><span class="si">{</span><span class="n">best_model_name</span><span class="si">}</span><span class="s2"> 进行超参数调优...&quot;</span><span class="p">)</span>

<span class="c1"># 寻找最优参数</span>
<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span>
        <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
        <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
        <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;GBDT&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;AdaBoost&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;LightGBM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">127</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;poly&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="n">param_grids</span><span class="p">:</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">best_model_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">best_model</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">adjusted_param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;model__</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> 
            <span class="n">adjusted_param_grid</span><span class="p">,</span> 
            <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">best_model</span><span class="p">,</span>
            <span class="n">param_grid</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>  

    <span class="n">tuned_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
    <span class="n">best_params</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>

    <span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
        <span class="n">cleaned_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;model__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cleaned_params</span> <span class="o">=</span> <span class="n">best_params</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">最优参数: </span><span class="si">{</span><span class="n">cleaned_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;交叉验证最佳AUC: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># 在测试集上评估调优后的模型</span>
    <span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tuned_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">y_prob</span> <span class="o">=</span> <span class="n">tuned_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tuned_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">y_prob</span> <span class="o">=</span> <span class="n">tuned_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">调优后模型分类报告:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;测试集ROC AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_prob</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">best_model</span> <span class="o">=</span> <span class="n">tuned_model</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">best_model_name</span><span class="si">}</span><span class="s2"> 没有需要调优的参数，使用初始模型&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
        <span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>
        <span class="n">y_prob</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">y_prob</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">最终最优模型: </span><span class="si">{</span><span class="n">best_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>开始对 Random Forest 进行超参数调优...
Fitting 5 folds for each of 108 candidates, totalling 540 fits
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-10 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-10 {
  color: var(--sklearn-color-text);
}

#sk-container-id-10 pre {
  padding: 0;
}

#sk-container-id-10 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-10 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-10 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-10 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-10 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-10 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-10 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-10 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-10 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-10 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-10 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-10 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-10 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-10 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-10 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-10 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-10 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-10 div.sk-label label.sk-toggleable__label,
#sk-container-id-10 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-10 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-10 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-10 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-10 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-10 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-10 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-10 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-10 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-10 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-10 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-10" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5, estimator=RandomForestClassifier(random_state=42), n_jobs=-1,
             param_grid={&#x27;max_depth&#x27;: [None, 5, 10, 15],
                         &#x27;min_samples_leaf&#x27;: [1, 2, 4],
                         &#x27;min_samples_split&#x27;: [2, 5, 10],
                         &#x27;n_estimators&#x27;: [50, 100, 200]},
             scoring=&#x27;roc_auc&#x27;, verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=5, estimator=RandomForestClassifier(random_state=42), n_jobs=-1,
             param_grid={&#x27;max_depth&#x27;: [None, 5, 10, 15],
                         &#x27;min_samples_leaf&#x27;: [1, 2, 4],
                         &#x27;min_samples_split&#x27;: [2, 5, 10],
                         &#x27;n_estimators&#x27;: [50, 100, 200]},
             scoring=&#x27;roc_auc&#x27;, verbose=1)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">best_estimator_: RandomForestClassifier</label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(n_estimators=200, random_state=42)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(n_estimators=200, random_state=42)</pre></div> </div></div></div></div></div></div></div></div></div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>最优参数: {&#39;max_depth&#39;: None, &#39;min_samples_leaf&#39;: 1, &#39;min_samples_split&#39;: 2, &#39;n_estimators&#39;: 200}
交叉验证最佳AUC: 0.9651

调优后模型分类报告:
              precision    recall  f1-score   support

           0       0.96      0.99      0.98      1405
           1       0.94      0.82      0.88       284

    accuracy                           0.96      1689
   macro avg       0.95      0.90      0.93      1689
weighted avg       0.96      0.96      0.96      1689

测试集ROC AUC: 0.9829

最终最优模型: Random Forest
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">best_model_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;SVM&quot;</span><span class="p">]:</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>
    <span class="n">y_prob</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_prob</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="id26">
<h2>5.1.2 模型报告——最优模型 最佳参数<a class="headerlink" href="#id26" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">最终模型分类报告:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;最佳模型 </span><span class="si">{</span><span class="n">best_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;最佳参数 </span><span class="si">{</span><span class="n">cleaned_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;最终ROC AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_prob</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>最终模型分类报告:
最佳模型 Random Forest
最佳参数 {&#39;max_depth&#39;: None, &#39;min_samples_leaf&#39;: 1, &#39;min_samples_split&#39;: 2, &#39;n_estimators&#39;: 200}
              precision    recall  f1-score   support

           0       0.96      0.99      0.98      1405
           1       0.94      0.82      0.88       284

    accuracy                           0.96      1689
   macro avg       0.95      0.90      0.93      1689
weighted avg       0.96      0.96      0.96      1689

最终ROC AUC: 0.9829
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id27">
<h1>六、可视化大屏<a class="headerlink" href="#id27" title="Link to this heading">#</a></h1>
<section id="tableau">
<h2>该部分用tableau实现<a class="headerlink" href="#tableau" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id28">
<h1>七、报告<a class="headerlink" href="#id28" title="Link to this heading">#</a></h1>
<p><strong>1. 用户特征方面</strong>
<br> 产品或服务在男性群体中更受欢迎，但应分析女性用户较少的原因，如进行市场调研了解女性需求，针对性地优化产品或服务以吸引更多女性用户。
<br> 主要受众集中在年龄组 4 所代表的年龄段，可根据该年龄段用户需求重点开发产品和进行市场推广，同时探索吸引其他年龄段用户的方法。
<br> 已婚用户数量最多，可针对已婚人群生活特点和需求进行精准营销，同时拓展单身和离婚人群市场份额。
<br><strong>2. 用户行为方面</strong>
<br> 根据用户在 App 上花费时间集中在 2 - 3 小时的特点，合理安排推送内容和活动时间，提高用户参与度。
<br> 对于下单数量差异大的情况，对下单数量多的用户进行忠诚度激励，分析下单少的用户需求以提高整体下单量。
<br> 对距离上次下单时间较长的用户进行精准营销，如发送优惠券、推荐热门商品等，促进再次下单。
<br><strong>3. 用户流失方面</strong>
<br> 虽然整体用户流失比例较小，但需关注流失的 948 名用户，分析流失原因。
<br> 针对男性用户流失数量较多的情况，调研男性用户需求和反馈，优化产品或服务及营销策略。
<br> 对流失用户数量较多的年龄组 3、4、5 进行专项调研，了解需求和痛点并优化产品或服务。
<br><strong>已流失客户多为在 3 - 5 年龄组、使用时长较短、满意度中等、订单数量较少的群体，且投诉情况对客户流失有一定影响</strong>。可以针对这些特点进一步分析原因，如优化服务、提高客户满意度、增加用户粘性等，以减少客户流失。</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">分析思路</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">一、数据处理</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.1 处理缺失值</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">查看以下字段数据分布来确定缺失值填充方法</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">二、用户特征深度解析</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1 静态属性特征</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a1">a1 高频登录终端类型-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a2">a2 高频登录终端类型-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b1">b1 城市等级-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b2">b2 城市等级-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c1">c1 性别分布-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c2">c2 性别分布-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d1">d1 用户年龄-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d2">d2 用户年龄-数据可视化</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">2.2 动态属性特征</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">a1 服务满意度评级-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">a2 服务满意度评级-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b1-app">b1 APP使用时长-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">c1 上月客诉-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">c2 上月客诉-可视化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">d1 关注的主播总数-数据处理</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">d2 关注的主播总数-可视化</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">三、特征与流失相关性</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">3.1 相关性分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-cramer-s-v">对数据进行编码后采用默认的pearson，这种方法具有一定的局限性，所以后续结合随机森林来确定哪些特征进入模型。<br/>效果不好的情况可以采用点二列相关系数、Cramer”s V系数或者综合用互信息等相关方法</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">3.1.1 读取处理之后的数据</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">3.1.2 对分类变量进行独热编码</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">3.1.3 计算相关性</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">3.1.4 使用随机森林来筛选重要特征</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">查看数据样本是否均衡</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">数据存在轻微不平衡 可以先不处理，后续模型表现不佳的情况可以重新处理</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">打乱数据</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">四、客户画像–基于筛选出的重要特征构建已流失客户的客户画像</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">4.1.1 已流失客户的客户画像概述</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">五、建立客户流失预测模型</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gbdtadaboostlightgbm-svm">5.1.1 对比各种逻辑回归、决策树、随机森林、GBDT、adaboost、LightGBM、朴素贝叶斯，svm算法的表现</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">5.1.2 模型报告——最优模型 最佳参数</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">六、可视化大屏</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tableau">该部分用tableau实现</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">七、报告</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By HDY
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright HDY.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>